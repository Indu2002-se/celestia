"use strict";(self.webpackChunkcelestia=self.webpackChunkcelestia||[]).push([[19],{19:(e,t,o)=>{o.d(t,{sendConfirmationEmail:()=>n});var i=o(312);const n=async e=>{const t=["booking_id","email","name","event_title","event_date","reference_number"];for(const i of t)if(!e[i])throw new Error(`Missing required field: ${i}`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))throw new Error("Invalid email address");let o,n=0;for(;n<3;)try{n++;const{data:t,error:o}=await i.N.functions.invoke("send-confirmation-email",{body:e});if(o)throw o;return await i.N.from("bookings").update({email_sent:!0}).eq("id",e.booking_id),console.log(`Email sent successfully to ${e.email} (Attempt: ${n})`),t}catch(r){if(console.error(`Error sending confirmation email (Attempt: ${n}):`,r),o=r,n<3){const e=500*Math.pow(2,n);await new Promise(t=>setTimeout(t,e))}}throw console.error("Failed to send email after 3 attempts"),o||new Error("Failed to send confirmation email")}}}]);
//# sourceMappingURL=19.11b1c610.chunk.js.map